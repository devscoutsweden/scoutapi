== Response Compression

The server supports response compression using deflate or gzip. Simply add the
Accept-Encoding header to your request, as shown in the samples below:

Requesting the response to be uncompressed (using the http client "curl"):

    curl --output scoutapi.flat --header "Authorization: Token token=\"85df3deb58\"" http://devscout.mikaelsvensson.info:10081/api/v1/activities?age_1=8&age_2=9

...will return 974232 bytes (at the time of testing)

Requesting the response to be "gzip compressed" (using the http client "curl"):

    curl --output scoutapi.gzip --header "Authorization: Token token=\"85df3deb58\"" --header "Accept-Encoding: gzip" http://devscout.mikaelsvensson.info:10081/api/v1/activities?age_1=8&age_2=9

...will return 241437 bytes (roughly 75% less than the uncompressed response)

Requesting the response to be "deflate compressed" (using the http client "curl"):

    curl --output scoutapi.deflate --header "Authorization: Token token=\"85df3deb58\"" --header "Accept-Encoding: deflate" http://devscout.mikaelsvensson.info:10081/api/v1/activities?age_1=8&age_2=9

...will return 241419 bytes (roughly 75% less than the uncompressed response)


== Create new category

Request

  POST "/api/v1/categories"
  Authorization: Token token="4d7a9ae16d0092c35f63"
  Content-Type: application/json

  {
    "group": "Scout Program Track",
    "name": "Relationships"
  }

Response if successful

  Status Code: 201 Created

  {
    "id": 4,
    "group": "Scout Program Track",
    "name": "Relationships",
    "status": null,
    "created_at": "2014-08-23T10:32:54.081Z",
    "updated_at": "2014-08-23T10:32:54.081Z",
    "user_id": null
  }

Response if error occurred (example when group and name are not unique)

  Status Code: 422 Unprocessable Entity

  {
    "error": "The input values conflict with another object. Perhaps the name is already taken?"
  }

== Update a category

Request

  PUT "/api/v1/categories"
  Authorization: Token token="4d7a9ae16d0092c35f63"
  Content-Type: application/json

  {
    "group": "Scout Program Track",
    "name": "Relationships"
  }

Response if successful

  Status Code: 204 No Content

Response if error occurred (example when group and name are not unique)

  Status Code: 422 Unprocessable Entity

  {
    "error": "The input values conflict with another object. Perhaps the name is already taken?"
  }

== Delete a category

Request

  DELETE "/api/v1/categories/1"
  Authorization: Token token="4d7a9ae16d0092c35f63"
  Content-Type: application/json

Response if successful

  Status Code: 204 No Content

Response if error occurred (example when category does not exist)

  Status Code: 404 Not Found

  {
    "error": "The requested object does not exist."
  }

== Upload new media file

There are two ways of adding files to the database:

* Specify an URL where the file is located. The URL will be stored in the database but the file itself will not be
  downloaded by the server. This means that the API requires the other server, the server where the file is actually
  stored, to remain online.
* Encode the image using Base64 and include the resulting string in the request. The file will be stored on the server
  and will be publicly accessible, albeit under a hard-to-guess name. The relative path to the file, rather than the
  full URL, will be stored in the database.

Request to create a media item which references file on other server:

    POST http://127.0.0.1:3000/api/v1/media_files HTTP/1.1
    Authorization: Token token="664a2072e2"
    Content-Type: application/json
    {
        "mime_type": "image/jpeg",
        "uri": "http://example.com/illustration.jpg"
    }

Request to upload media item to the API server:

    POST http://127.0.0.1:3000/api/v1/media_files HTTP/1.1
    Authorization: Token token="664a2072e2"
    Content-Type: application/json
    {
        "mime_type": "image/png",
        "data": "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"
    }

Response:

    HTTP/1.1 201 Created
    {
        "id":36,
        "mime_type":"image/jpeg",
        ...
    }

== Get media files

/file

TODO: Write about how media files are fetched, including how they are automatically resized to the requested size.

== Ping

The API has a "ping feature" which enables external systems to poll whether or not the API is online.

Request:

    GET http://127.0.0.1:3000/api/v1/system/ping HTTP/1.1

Response:

    HTTP/1.1 204 No Content

== System Messages

The API has a simple mechanism for providing system messages to clients. These messages are simple key-value pairs which
are used to inform and instruct the clients about changes to the API, e.g. scheduled down-time and DNS names. Since some
types of messages (instructions) are only valid for a certain period of time, each system messages may have a time span
specified which tells clients when the messages (i.e. instruction) is to be used/applied/considered.

This mechanism allows administrators to:

* Prepare client applications for server changes, e.g. by sending out information about the API server's new host name and the date from which this new host name will be valid. Clients will then know that requests must be sent to that new address from that date.
* Send maintenance notifications to end-users, e.g. notifying them of scheduled server outages.

Keys does not have to be unique, not even within a certain time span. Clients must be able to handle multiple current
values for the same key (property). The only way of referring to a system message is by its database id (primary key
value).

Example keys and values:

* api:dns:primary = "api.devscout.se"
* api:dns:secondary = "12.34.56.78"
* client:androidapp-1.0:enablephotoupload = "false"
* message:androidapp-0.0-0.9 = "Support for your version of the app will end after May. Please upgrade to the latest version using Google Play Store."

=== Reserved keys

This list shows keys (configuration properties) with agreed-upon meanings.

[api:host] The host name and port used to connect to the API. Sample value: api.devscout.se:8080.
[contact:error] URL to which to send error and bug reports. Sample value: mailto:api@devscout.se or http://api.devscout.se/report_error.
[contact:info] URL used to contact the API development team. Sample value: mailto:api@devscout.se.

=== Add new system message

Request:

    POST http://127.0.0.1:3000/api/v1/system_messages HTTP/1.1
    Authorization: Token token="664a2072e2"
    {
    	"key": "test:key1",
    	"value": "Valid after 2015-05-20",
    	"valid_to": null,
    	"valid_from": "2015-05-20T00:00:00.000Z"
    }

Response:

    HTTP/1.1 201 Created
    {
       "id": 10,
       "key": "test:key1",
       "value": "Valid after 2015-05-20",
       "valid_to": null,
       "valid_from": "2015-05-20T00:00:00.000Z",
       "created_at": "2015-05-17T06:56:08.241Z",
       "updated_at": "2015-05-17T06:56:08.241Z",
       "user_id": 7
    }


=== Edit system message

Request:

    PUT http://127.0.0.1:3000/api/v1/system_messages/1 HTTP/1.1
    Authorization: Token token="664a2072e2"
    {
       "key": "test:key2",
       "value": "The second test",
       "valid_to": null,
       "valid_from": null
    }

Response:

    HTTP/1.1 204 No Content


=== List system messages

The API supports two filtering parameters:

* key: Return messages whose key starts with this value.
* key[]: Return messages whose key starts with either of the specified values.
* valid: Either "now" or "now_and_future".
  * "now" returns messages which are valid right now
  * "now_and_future" returns messages which are valid right now but also messages which will be valid sometime in the future.

Note that reading system messages does NOT require any authentication (all clients should always be able to read any system message).

Request for all messages:

    GET http://127.0.0.1:3000/api/v1/system_messages HTTP/1.1

Request for currently valid messages:

    GET http://127.0.0.1:3000/api/v1/system_messages?valid=now HTTP/1.1

Request for messages where the key starts with "client:android" or "test":

    GET http://127.0.0.1:3000/api/v1/system_messages?key%5B%5D=client:android&key%5B%5D=test HTTP/1.1

Sample response:

    [
       {
          "id": 6,
          "key": "test:key1",
          "value": "Valid after 2015-05-20",
          "valid_to": null,
          "valid_from": "2015-05-20T00:00:00.000Z",
          "created_at": "2015-05-17T06:54:03.731Z",
          "updated_at": "2015-05-17T06:54:03.731Z",
          "user_id": 7
       },
       ...
    ]

=== Delete system message

Request (deletes system message 1):

    DELETE http://127.0.0.1:3000/api/v1/system_messages/1 HTTP/1.1
    Authorization: Token token="664a2072e2"

Response:

    HTTP/1.1 204 No Content
